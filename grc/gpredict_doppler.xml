<?xml version="1.0"?>
<!--
   Copyright 2015 Wolfgang Nagele

   Licensed under the Apache License, Version 2.0 (the "License");
   you may not use this file except in compliance with the License.
   You may obtain a copy of the License at

       http://www.apache.org/licenses/LICENSE-2.0

   Unless required by applicable law or agreed to in writing, software
   distributed under the License is distributed on an "AS IS" BASIS,
   WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   See the License for the specific language governing permissions and
   limitations under the License.
-->
<block>
  <name>GPredict Doppler</name>
  <key>gpredict_doppler</key>
  <category>[GPredict]</category>
  <import>import gpredict</import>
  <make>gpredict.doppler(self.set_$target(), "$gpredict_host()", $gpredict_port(), $verbose())</make>

  <param>
    <name>Variable</name>
    <key>target</key>
    <value>doppler_freq</value>
    <type>string</type>
  </param>

  <param>
    <name>Gpredict Host</name>
    <key>gpredict_host</key>
    <value>localhost</value>
    <type>string</type>
  </param>
  <param>
    <name>Gpredict Port</name>
    <key>gpredict_port</key>
    <value>7356</value>
    <type>int</type>
  </param>

  <param>
    <name>Verbose</name>
    <key>verbose</key>
    <value>False</value>
    <type>bool</type>
    <option>
      <name>No</name>
      <key>False</key>
    </option>
    <option>
      <name>Yes</name>
      <key>True</key>
    </option>
  </param>
  
  <source>
    <name>freq</name>
    <type>message</type>
    <optional>1</optional>
  </source>
  
  <source>
    <name>state</name>
    <type>message</type>
    <optional>1</optional>
  </source>
<doc>
This block is an enhanced and modernized block for receiving GQRX-compatible radio commands from external systems such as gpredict.  The system listens on a TCP connection for the appropriate command, and when received sets the specified flowgraph variable to the received value.  The frequency is also output on a message block that is compatible with other blocks such as the USRP source freq message input.  

If the radio sends AOS (Acquisition of Signal) and LOS (Loss of Signal) messages (format is just "AOS\n" or "LOS\n"), the state message port will output a 1 (AOS) or a 0 (LOS) compatible with other state processing blocks in modules such as gr-filerepeater.

NOTE: The variable provided to receive the frequency CANNOT be tied to a GUI control or QT will throw an exception.  It must be a variable.  So you have 2 options to control frequency to a radio here, 1. set the variable to "freq" for this block and use that to control the radio source, or for blocks such as USRP source use the message out to tie it to the freq in of another block.
</doc>
</block>
